{% extends 'AppBundle:Default:index.html.twig' %}
{% block title %}Liste de voyages {% endblock %}
{% block head %}
    <link href="{{ asset("assets/app/css/liste.css") }}" rel="stylesheet">
    {% if app.request.attributes.get('_route') == "search" %}
        <script src="{{ asset("assets/app/js/search.js") }}"></script>
    {% else %}
        <script src="{{ asset("assets/app/js/list.js") }}"></script>
    {% endif %}
{% endblock %}

{% block body %}
    {% set is_search = app.request.attributes.get('_route') == "search" %}
    <i class="fa fa-globe" aria-hidden="true"></i>
    <h2>Les offres voyages</h2>
    <div class="container-fluid">
        <div class="row">
            <form class="form-inline margin-bottom20" id="orderForm">
                <div class="form-group">
                    <label for="sort">Trier par</label>
                    <select name="sort" id="sort" class="form-control">
                        {% for critera, key in criteras %}
                            {% set selected = key == app.request.attributes.get('sort') ? "selected" : "" %}
                            <option value="{{ key }}" {{ selected }}>{{ critera }}</option>
                        {% endfor %}
                    </select>
                    <label for="order">Ordre</label>
                    <select name="order" id="order" class="form-control">
                        <option value="desc" {{ "desc" == app.request.attributes.get('order') ? "selected" : "" }}>
                            Desc
                        </option>
                        <option value="asc" {{ "asc" == app.request.attributes.get('order') ? "selected" : "" }}>Asc
                        </option>
                    </select>
                    <button type="submit" class="btn btn-default">Valider</button>
                    {% if is_search %}
                        <a href="{{ path("search") }}">Retourner Ã  la recherche</a>
                    {% endif %}
                </div>
            </form>
            {% for travel in travels %}
                <div class="col-sm-6 col-md-4">
                    <div class="overlay">
                        {% set img = "uploads/images/"~ travel.images.get(0).file.filename %}
                        <img class="img-responsive center-block" src="{{ asset(img) }}" alt="{{ travel.title }}">
                        <div class="img_desc">
                            <a href="{{ path("detail_page", {'slug': travel.slug}) }}">{{ travel.title }}</a>
                            <hr>
                            <a href="{{ path("detail_page", {'slug': travel.slug}) }}">Voir plus</a>
                        </div>
                    </div>
                    <div class="caption">
                        <h3>
                            <a href="{{ path("detail_page", {'slug': travel.slug}) }}">{{ travel.title }}</a>
                            <small class="pull-right">{{ travel.availablePlaces }}/{{ travel.places }} places</small>
                        </h3>
                        <p class="text-center">{{ travel.description }}</p>
                    </div>
                </div>
            {% endfor %}

            {% if pager is defined and pager.haveToPaginate %}
                <div class="pagerfanta col-center-block col-md-12 text-center">
                    {% if is_search %}
                        {% set routeParams = app.request.query.all %}
                    {% else %}
                        {% set routeParams = {'sort': app.request.attributes.get('sort'), 'order':app.request.attributes.get('order')} %}
                    {% endif %}
                    {{ pagerfanta(pager , 'twitter_bootstrap3_translated',
                    {'routeName': app.request.attributes.get('_route'), 'routeParams': routeParams}) }}
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

